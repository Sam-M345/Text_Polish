# SECONDâ€‘OPINION REVIEW â€“ Mobile Dropdown Overlay Issue

## 1 Â· What we reviewed
* [`public/index.html`](../public/index.html) â€“ contains the `<select id="tone-select">` element that triggers the problem.  
* [`public/style.css`](../public/style.css) â€“ declares `#page-overlay` plus base dropdown styling.  
* [`public/script.js`](../public/script.js) â€“ adds / removes the `.overlay-active` class on `<body>` when the native `<select>` gains / loses focus.  

---

## 2 Â· Root cause

Mobile browsers (especially **iOSÂ Safari**) do **not** render the native `<select>`
picker inside the normal DOM stacking context.  
Instead the OS paints the picker **in its own compositor layer above _every_ HTML
element**, ignoring any `z-index` or overlay you draw in the page.  
Therefore the black `#page-overlay` works on desktop but is **visually
superseded on mobile**.

---

## 3 Â· Recommended fix â€“ replace the native `<select>`

The only robust way to get a fullyâ€‘opaque background on mobile is to **stop
using the native control** and build a **custom dropdown** that *lives inside
the DOM*.  That allows your `#pageâ€‘overlay` (or any modal) to sit above normal
content, while the custom menu itself may be given a higher `z-index` so it
appears on top of the overlay.

### 3.1Â Highâ€‘level plan

| Step | Action | Why |
| ---- | ------ | --- |
|Â 1Â |Â Convert `<select id="tone-select">â€¦</select>` â†’ a `<button>` that opens a `<div class="tone-menu">` containing a `<ul>` of options. | 100â€¯% CSSâ€‘controllable, no native UI. |
|Â 2Â |Â Move all existing `<optgroup>` / `<option>` data into a small **JSON** array in `script.js` to generate the menu dynamically (keeps markup clean, makes future edits easy). | Single source of truth. |
|Â 3Â |Â Add ARIA roles:<br>`role="button"` on the trigger,<br>`role="listbox"` on the menu,<br>`role="option"` on each item,<br>`aria-expanded`, `aria-selected`, etc. | Keyboard & screenâ€‘reader accessibility. |
|Â 4Â |Â Reuse the existing `#page-overlay`:<br>â€¢ `opacity:0 â†’Â 1` when menu opens.<br>â€¢ Close menu + overlay on **tap outside**, **Esc key**, or **option click**. | Matches current desktop behaviour. |
|Â 5Â |Â Update `script.js`:<br>â€¢ Remove the `focus` / `blur` listeners on `<select>`.<br>â€¢ Add click listener on the new trigger button.<br>â€¢ Toggle classesÂ `.menu-open` and `.overlay-active`. | Connect UI to overlay logic. |
|Â 6Â |Â Hide the old `<select>` with `display:none` *for now* to avoid breaking existing form posts; once new component is stable you can delete it. | Nonâ€‘breaking incremental change. |

### 3.2Â Minimal code example (pseudoâ€‘diff)

```html
<!-- OLD -->
<select id="tone-select">â€¦</select>

<!-- NEW -->
<button id="tone-trigger" class="tone-trigger" aria-haspopup="listbox" aria-expanded="false">
  LetÂ AIÂ ChooseÂ âš™ï¸
</button>
<div id="tone-menu" class="tone-menu" role="listbox" hidden>
  <!-- options injected by JS -->
</div>
```

```css
/* Overlay already exists â€“ keep it. */

/* NEW: menu styling */
.tone-menu {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  max-width: 90vw;
  width: 320px;
  background: var(--card-bg);
  border: 1px solid var(--border-color);
  border-radius: 12px;
  padding: 0.5rem 0;
  z-index: 999;           /* above #page-overlay (998) */
  overflow-y: auto;
}
.tone-menu li[role="option"] {
  padding: 0.7rem 1.1rem;
  cursor: pointer;
}
.tone-menu li[aria-selected="true"],
.tone-menu li:hover {
  background: rgba(37,165,106,0.25);
}
body.menu-open {
  overflow:hidden;        /* prevent background scroll */
}
```

```js
// ---------- data ----------
const tones = [
  { group: "Everyday", options: [
      { value: "casual", label: "Casual ğŸ’¬" },
      { value: "warm",   label: "Warm ğŸ˜ŠğŸ™ğŸŠâ¤ï¸" },
      { value: "humor",  label: "Humor ğŸ˜‚" }
  ]},
  /* â€¦Professional & Expressiveâ€¦ */
];

// ---------- build menu once DOM ready ----------
const trigger = document.getElementById("tone-trigger");
const menu    = document.getElementById("tone-menu");
tones.forEach(({ group, options }) => {
  const groupLabel = document.createElement("li");
  groupLabel.textContent = group;
  groupLabel.className = "group-label";
  menu.appendChild(groupLabel);
  options.forEach(({ value, label }) => {
    const li = document.createElement("li");
    li.role = "option";
    li.dataset.value = value;
    li.textContent = label;
    menu.appendChild(li);
  });
});

// ---------- interaction ----------
trigger.addEventListener("click", () => {
  const expanded = trigger.getAttribute("aria-expanded") === "true";
  trigger.setAttribute("aria-expanded", !expanded);
  menu.hidden = expanded;
  document.body.classList.toggle("overlay-active", !expanded);
  document.body.classList.toggle("menu-open", !expanded);
});

menu.addEventListener("click", (e) => {
  const option = e.target.closest("li[role='option']");
  if (!option) return;
  // Update selection
  [...menu.querySelectorAll("[aria-selected]")].forEach(el => el.removeAttribute("aria-selected"));
  option.setAttribute("aria-selected", "true");
  trigger.textContent = option.textContent;
  trigger.dataset.value = option.dataset.value;
  // Close
  trigger.click();
});
```

*(Code is illustrative; adapt naming / styling to suit your codebase.)*

---

## 4 Â· Accessibility checklist

- **Tab key** moves focus to trigger â†’ Enter/Space opens menu.  
- **Up/Down arrows** move through items; **Enter/Space** selects.  
- **Esc** closes menu and returns focus to trigger.  
- Screenâ€‘readers announce â€œTone, button, collapsed / expandedâ€.  
- `ariaâ€‘selected="true"` is set on currently chosen option.

---

## 5 Â· Regression test matrix

| Device / Browser | Expected result |
| ---------------- | --------------- |
| iOSÂ 17 Safari    | Background fully black, menu styled as per design, no native picker visible. |
| AndroidÂ Chrome   | Same as iOS, no overflow scrolling while menu open. |
| Desktop Chrome   | Overlay + menu render, keyboard works. |
| Desktop Firefox  | Ditto. |

---

## 6 Â· Cleanâ€‘up tasks (postâ€‘merge)

1. Delete the old `<select>` element and its `toneSelect` logic once QA passes.  
2. Remove `.overlay-active` toggle on native `focus` / `blur` events.  
3. Decide whether to keep the JSON data inline or move it to a separate `tones.json` for CMSâ€‘driven edits.

---

### ğŸ“  Attachments

*None â€“ all changes described above.*

---

_Questions?  Ping @Sam or the Frontâ€‘End guild in SlackÂ #uiâ€‘ux._
